.\" generated with Ronn/v0.7.3
.\" http://github.com/rtomayko/ronn/tree/0.7.3
.
.TH "PICARDMETRICS" "1" "April 2015" "picardmetrics-0.1.3" "picardmetrics manual"
.
.SH "NAME"
\fBpicardmetrics\fR \- Run Picard tools and collate multiple metrics files
.
.SH "SYNOPSIS"
\fBpicardmetrics\fR run [\-f \fIFILE\fR] [\-o \fIDIR\fR] [\-r] <file\.bam>
.
.P
\fBpicardmetrics\fR collate \fIPREFIX\fR \fIDIR\fR
.
.P
\fBpicardmetrics\fR run \-r \-o out data/project1/sample1/sample1\.bam
.
.P
\fBpicardmetrics\fR run \-r \-o out data/project1/sample2/sample2\.bam
.
.P
\fBpicardmetrics\fR collate out/project1 out
.
.SH "DESCRIPTION"
\fBPicardmetrics\fR is a Bash script that simplifies calling Picard tools and collates the different output files generated by Picard\.
.
.P
It will detect if your BAM file is sorted, or create a new sorted copy with Picard SortSam if it is not\. Next, it will call up to 10 different Picard tools\.
.
.P
After running the tools, picardmetrics can collate all of the generated metrics generated from multiple BAM files into tab\-delimited files\. Finally, the many tab\-delimited files are also consolidated into a single file with all metrics from all BAM files and all Picard tools\.
.
.P
Find more details here: \fIhttps://github\.com/slowkow/picardmetrics\fR
.
.SH "COMMANDS AND OPTIONS"
.
.SS "run"
\fBpicardmetrics\fR run [\-f \fIFILE\fR] [\-o \fIDIR\fR] [\-r] <file\.bam>
.
.IP "\(bu" 4
\fB\-f\fR \fIFILE\fR
.
.IP
The configuration file with specified environment variables\. In order of preference, \fBpicardmetrics\fR will use (1) the specified file, (2) a file named \fBpicardmetrics\.conf\fR in the current directory or (3) in the user\'s HOME directory\. If no file is found, an error will be thrown and the program will exit\.
.
.IP "\(bu" 4
\fB\-o\fR \fIDIR\fR
.
.IP
Write 23 output files in this directory\. By default, write to the current directory\. The output files include:
.
.IP
1 BAM file sorted by coordinate and with duplicates marked
.
.br
6 log files for the Picard tools
.
.br
5 PDF files with plots generated by Picard tools
.
.br
11 text files with metrics
.
.IP "\(bu" 4
\fB\-r\fR
.
.IP
The BAM file is from an RNA\-seq experiment\. By default, this is not true\. When this option is used, the \fBCollectRnaSeqMetrics\fR Picard tool is run\. This option requires the environment variables \fBREF_FLAT\fR and \fBRIBOSOMAL_INTERVALS\fR to be set\. You should specify them in the configuration file\.
.
.IP "\(bu" 4
\fB\-k\fR
.
.IP
Keep the output BAM file\. By default, delete it after metrics are created\.
.
.IP "" 0
.
.SS "collate"
\fBpicardmetrics\fR collate \fIPREFIX\fR \fIDIR\fR
.
.P
Output metrics files in \fIDIR\fR will be collated\. Next, a file named \fIPREFIX\fR\-all\-metrics\.tsv will be created in \fIDIR\fR with all metrics from all Picard tools and all BAM files\.
.
.SH "ENVIRONMENT VARIABLES"
The \fBpicardmetrics\.conf\fR file must define the following envrionment variables:
.
.IP "\(bu" 4
\fBNICENESS\fR
.
.IP
A number between 0 and 20 specifying the niceness to use for all jobs\. Use a number greater than 0 to avoid interrupting interactive jobs such as vim or emacs\.
.
.IP "\(bu" 4
\fBPICARD_JAR\fR
.
.IP
The full path to a downloaded picard\.jar file\. Get the file here: https://broadinstitute\.github\.io/picard/index\.html
.
.IP "\(bu" 4
\fBPICARD\fR
.
.IP
Your preferred way to invoke Java to call Picard\. For example:
.
.IP
\fBPICARD="java \-Xms5g \-Xmx5g \-jar $PICARD_JAR"\fR
.
.IP "\(bu" 4
\fBREFERENCE_SEQUENCE\fR
.
.IP
The full path to the organism\'s genome sequence in FASTA format\. Required for: \fBCollectMultipleMetrics\fR, \fBCollectRnaSeqMetrics\fR, \fBCollectGcBiasMetrics\fR\.
.
.IP "\(bu" 4
\fBREF_FLAT\fR
.
.IP
Full path to a text file with annotations of all gene features in UCSC format\. Can be generated from a GFF or GTF file\. Required for: \fBCollectRnaSeqMetrics\fR\.
.
.IP "\(bu" 4
\fBRIBOSOMAL_INTERVALS\fR
.
.IP
Full path to a text file with genomic coordinates of all ribosomal RNA genes in Picard format\. Required for \fBCollectRnaSeqMetrics\fR\.
.
.IP "" 0
.
.SH "EXAMPLES"
Here are three examples of how you can run the program:
.
.IP "1." 4
Run \fBpicardmetrics\fR sequentially in a for loop on multiple BAM files\.
.
.IP "2." 4
Run in parallel with GNU parallel, using multiple processors or multiple servers\.
.
.IP "3." 4
Run in parallel with an LSF queue, distributing jobs to multiple servers\.
.
.IP "" 0
.
.SS "Example 1: Sequential"
Run the Picard tools on the provided example BAM files:
.
.IP "" 4
.
.nf

for f in data/project1/sample?/sample?\.bam; do
  picardmetrics run \-o out \-r $f
done
.
.fi
.
.IP "" 0
.
.P
Collate the generated metrics files:
.
.IP "" 4
.
.nf

picardmetrics collate out/project1 out
.
.fi
.
.IP "" 0
.
.SS "Example 2: GNU parallel"
Run 2 jobs in parallel:
.
.IP "" 4
.
.nf

parallel \-j2 \e
  picardmetrics run \-o /path/to/out \-r {} ::: data/project1/sample?/sample?\.bam
.
.fi
.
.IP "" 0
.
.P
If you have many files, or if you want to run jobs on multiple servers, it\'s a good idea to put the full paths in a text file\.
.
.P
Here, we have ssh access to \fBserver1\fR and \fBserver2\fR\. We\'re launching 16 jobs on \fBserver1\fR and 8 jobs on \fBserver2\fR\. You\'ll have to make sure that \fBpicardmetrics\fR is in your \fBPATH\fR on all servers\.
.
.IP "" 4
.
.nf

ls /full/path/to/data/project1/sample*/sample*\.bam > bams\.txt
parallel \-S 16/server1,8/server2 \e
  picardmetrics run \-r \-o /path/to/out {} :::: bams\.txt
.
.fi
.
.IP "" 0
.
.SS "Example 3: LSF"
I recommend you install and use asub (see below) to submit jobs easily\. This command will submit a job for each BAM file to the \fBmyqueue\fR LSF queue\.
.
.IP "" 4
.
.nf

cat bams\.txt | xargs \-i echo picardmetrics run \-r \-o /path/to/out {} \e
  | asub \-j picardmetrics_jobs \-q myqueue
.
.fi
.
.IP "" 0
.
.SH "BUGS"
Please report issues here:
.
.br
\fIhttps://github\.com/slowkow/picardmetrics/issues\fR
.
.SH "AUTHOR"
Kamil Slowikowski from Harvard University wrote picardmetrics\. Many developers at the Broad Institute wrote Picard\. Heng Li from the Sanger Institute wrote samtools\. Aaron Quinlan from the University of Utah wrote stats\.
.
.SH "SEE ALSO"
picardmetrics \fIhttps://github\.com/slowkow/picardmetrics\fR
.
.br
Picard \fIhttps://broadinstitute\.github\.io/picard\fR
.
.br
samtools \fIhttps://github\.com/samtools/samtools\fR
.
.br
stats \fIhttps://github\.com/arq5x/filo\fR
.
.br
GNU parallel \fIhttps://www\.gnu\.org/software/parallel/parallel_tutorial\.html\fR
.
.br
LSF \fIhttp://www\.vub\.ac\.be/BFUCC/LSF/\fR
.
.br
asub \fIhttps://github\.com/lh3/asub\fR
